# requirement_matrix.yaml
# Machine-readable policy → requirement mapping
# Based on GovLens Design Spec v1.0

policies:
  # ═══════════════════════════════════════════════════════════════════════════
  # SCP-001: CLAWBACK AND RECOVERY POLICY
  # ═══════════════════════════════════════════════════════════════════════════
  - code: SCP-001
    name: Clawback and Recovery Policy
    category: Financial Controls
    requirements:
      - id: R-001-01
        name: Revenue Reversal Clawback
        description: Plan must address clawback for cancelled/reversed transactions
        severity: HIGH
        detection:
          positivePatterns:
            - "chargeback"
            - "clawback"
            - "recovery"
            - "reversal"
            - "cancellation.*commission"
          negativePatterns:
            - "no clawback"
            - "non-recoverable"
          requiredElements:
            - name: triggering_events
              type: list
              expectedValues: ["cancellation", "return", "reversal", "adjustment"]
            - name: threshold
              type: value
            - name: timing
              type: value
        scoring:
          A: "Has explicit clawback with triggers, thresholds, and timing"
          B: "Mentions adjustments/chargebacks but no formal clawback framework"
          C: "Silent on recovery of overpayments"
        insertionPoint: "Section: When is Commission Earned OR new Section 20"

      - id: R-001-02
        name: Approval Authority
        description: Clawback amounts require tiered approval
        severity: MEDIUM
        detection:
          requiredElements:
            - name: approval_tiers
              type: list
              expectedValues: ["$5K", "$25K", "$50K+"]
            - name: approval_roles
              type: list
              expectedValues: ["Manager", "Director", "VP", "CRB"]
        scoring:
          A: "Explicit approval matrix by dollar threshold"
          B: "Mentions management approval, no tiers"
          C: "No approval requirement stated"
        insertionPoint: "Within clawback section"

      - id: R-001-03
        name: Recovery Mechanism
        description: Method of recovering overpaid commissions
        severity: HIGH
        detection:
          positivePatterns:
            - "payroll deduction"
            - "offset.*future"
            - "repayment"
          requiredElements:
            - name: max_deduction_rate
              type: value
              expectedValues: ["25% of net variable comp"]
            - name: notice_period
              type: value
              expectedValues: ["60 days advance"]
        scoring:
          A: "Explicit recovery method with limits and notice"
          B: "Says 'company may deduct' without limits"
          C: "No recovery mechanism defined"
        insertionPoint: "Section: Draw Payments or new Recovery section"

      - id: R-001-04
        name: Appeals Process
        description: Employee right to dispute clawback
        severity: MEDIUM
        detection:
          positivePatterns:
            - "appeal"
            - "dispute.*clawback"
            - "contest.*recovery"
          requiredElements:
            - name: timeline
              type: value
              expectedValues: ["30 days to appeal"]
            - name: review_body
              type: value
        scoring:
          A: "Formal appeals process with timeline and review body"
          B: "General dispute language exists, not specific to clawback"
          C: "No appeals right for clawbacks"
        insertionPoint: "Within clawback section"

  # ═══════════════════════════════════════════════════════════════════════════
  # SCP-002: QUOTA MANAGEMENT POLICY
  # ═══════════════════════════════════════════════════════════════════════════
  - code: SCP-002
    name: Quota Management Policy
    category: Performance Management
    requirements:
      - id: R-002-01
        name: Quota Setting Methodology
        description: Documented approach to setting quotas
        severity: MEDIUM
        detection:
          positivePatterns:
            - "quota.*methodology"
            - "territory potential"
            - "historical performance"
          requiredElements:
            - name: factors
              type: list
              expectedValues: ["historical", "territory potential", "strategic"]
            - name: weights
              type: value
        scoring:
          A: "Multi-factor methodology with weights documented"
          B: "Quotas mentioned but methodology not explained"
          C: "Quotas assigned without methodology disclosure"
        insertionPoint: "New Section: Quota Methodology"

      - id: R-002-02
        name: Mid-Year Adjustment Governance
        description: Approval thresholds for quota changes
        severity: HIGH
        detection:
          positivePatterns:
            - "quota.*change"
            - "adjustment.*approval"
          negativePatterns:
            - "subject to change at any time"
            - "sole discretion"
          requiredElements:
            - name: approval_tiers
              type: list
              expectedValues: ["<10%: Manager", "10-25%: Director", ">25%: VP/CRB"]
            - name: qualifying_triggers
              type: list
            - name: non_qualifying
              type: list
        scoring:
          A: "Approval tiers with thresholds and qualifying triggers"
          B: "Mentions changes possible, no governance"
          C: "Silent OR says 'change anytime at sole discretion'"
        insertionPoint: "Section: Modifications to Plan"

      - id: R-002-03
        name: Territory Change Quota Treatment
        description: How quota adjusts when territory changes
        severity: MEDIUM
        detection:
          requiredElements:
            - name: addition_treatment
              type: value
            - name: reduction_treatment
              type: value
            - name: in_flight_deals
              type: value
        scoring:
          A: "Explicit quota adjustment rules for territory changes"
          B: "Territory changes mentioned, no quota impact defined"
          C: "Silent on quota impact of territory changes"
        insertionPoint: "Section: Territory Management"

  # ═══════════════════════════════════════════════════════════════════════════
  # SCP-003: WINDFALL AND LARGE DEAL POLICY
  # ═══════════════════════════════════════════════════════════════════════════
  - code: SCP-003
    name: Windfall and Large Deal Policy
    category: Deal Governance
    requirements:
      - id: R-003-01
        name: Windfall Triggers
        description: Definition of what constitutes a windfall
        severity: HIGH
        detection:
          requiredElements:
            - name: transaction_threshold
              type: value
              expectedValues: ["$1M+ contract value"]
            - name: commission_threshold
              type: value
              expectedValues: ["$100K+ commission"]
            - name: quota_threshold
              type: value
              expectedValues: [">50% of annual quota"]
        scoring:
          A: "Explicit windfall criteria defined"
          B: "Large deal mentioned, no quantified triggers"
          C: "No windfall definition"
        insertionPoint: "New Section: Large Deal Governance"

      - id: R-003-02
        name: CRB Review Requirement
        description: Review body oversight of windfall deals
        severity: HIGH
        detection:
          positivePatterns:
            - "CRB"
            - "Compensation Review Board"
            - "executive review"
            - "special approval"
        scoring:
          A: "CRB review required with timeline and documentation"
          B: "Management discretion mentioned, no formal review"
          C: "No review requirement for large deals"
        insertionPoint: "Within windfall section"

      - id: R-003-03
        name: Treatment Options
        description: How windfall compensation is handled
        severity: MEDIUM
        detection:
          requiredElements:
            - name: options
              type: list
              expectedValues: ["cap", "amortize", "split credit", "special bonus"]
        scoring:
          A: "Multiple treatment options defined with criteria"
          B: "Cap mentioned, no other options"
          C: "No treatment options defined"
        insertionPoint: "Within windfall section"

  # ═══════════════════════════════════════════════════════════════════════════
  # SCP-005: SECTION 409A COMPLIANCE POLICY
  # ═══════════════════════════════════════════════════════════════════════════
  - code: SCP-005
    name: Section 409A Compliance Policy
    category: Legal Compliance
    requirements:
      - id: R-005-01
        name: Short-Term Deferral Safe Harbor
        description: Payment by March 15 following year
        severity: CRITICAL
        detection:
          positivePatterns:
            - "409A"
            - "short.term deferral"
            - "March 15"
            - "2.5 months"
          requiredElements:
            - name: payment_deadline
              type: value
              expectedValues: ["March 15 following year"]
        scoring:
          A: "Explicit 409A language with safe harbor timing"
          B: "Payment timing exists, no 409A reference"
          C: "No 409A compliance language"
        insertionPoint: "Section: Standard Terms and Conditions"

      - id: R-005-02
        name: Savings Clause
        description: Protection language for 409A compliance
        severity: CRITICAL
        detection:
          positivePatterns:
            - "409A.*compliance"
            - "construed.*409A"
            - "limited.*409A"
        scoring:
          A: "Explicit 409A savings clause"
          B: "Legal compliance language, not specific to 409A"
          C: "No savings clause"
        insertionPoint: "Section: Standard Terms and Conditions"

  # ═══════════════════════════════════════════════════════════════════════════
  # SCP-006: STATE WAGE LAW COMPLIANCE POLICY
  # ═══════════════════════════════════════════════════════════════════════════
  - code: SCP-006
    name: State Wage Law Compliance Policy
    category: Legal Compliance
    requirements:
      - id: R-006-01
        name: California Written Agreement
        description: CA Labor Code §2751 compliance
        severity: CRITICAL
        detection:
          positivePatterns:
            - "California"
            - "Labor Code"
            - "written agreement"
            - "§2751"
            - "2751"
          requiredElements:
            - name: written_agreement_language
              type: boolean
            - name: participant_acknowledgment
              type: boolean
        scoring:
          A: "Explicit CA written agreement requirement with §2751 reference"
          B: "Has acknowledgment but no CA-specific language"
          C: "No California compliance provisions"
        insertionPoint: "Section: Acknowledgement"

      - id: R-006-02
        name: Final Payment Timing
        description: State-specific final pay timing
        severity: CRITICAL
        detection:
          requiredElements:
            - name: ca_involuntary
              type: value
              expectedValues: ["immediate"]
            - name: ca_voluntary
              type: value
              expectedValues: ["72 hours"]
            - name: state_matrix
              type: boolean
        scoring:
          A: "State-specific final payment timing matrix"
          B: "Final payment mentioned, no state specifics"
          C: "No final payment timing provisions"
        insertionPoint: "Section: Payment Upon Termination"

      - id: R-006-03
        name: Deduction Consent
        description: State law requirements for payroll deductions
        severity: HIGH
        detection:
          positivePatterns:
            - "consent.*deduction"
            - "authorization.*deduct"
          requiredElements:
            - name: written_consent
              type: boolean
            - name: state_specific
              type: boolean
        scoring:
          A: "Written consent requirement with state-specific rules"
          B: "Deductions mentioned, no consent language"
          C: "No consent provisions for deductions"
        insertionPoint: "Section: When is Commission Earned"

  # ═══════════════════════════════════════════════════════════════════════════
  # SCP-007: SALES CREDITING POLICY
  # ═══════════════════════════════════════════════════════════════════════════
  - code: SCP-007
    name: Sales Crediting Policy
    category: Performance Management
    requirements:
      - id: R-007-01
        name: Crediting Decision Tree
        description: Documented rules for credit assignment
        severity: HIGH
        detection:
          positivePatterns:
            - "crediting.*rules"
            - "credit.*assignment"
          requiredElements:
            - name: decision_tree
              type: boolean
            - name: documentation_required
              type: boolean
        scoring:
          A: "Formal crediting decision tree with documentation in CRM"
          B: "Mentions crediting rules, no formal process"
          C: "Crediting determination by management discretion only"
        insertionPoint: "New Section: Sales Crediting Rules"

  # ═══════════════════════════════════════════════════════════════════════════
  # SCP-008: DRAWS AND GUARANTEES POLICY
  # ═══════════════════════════════════════════════════════════════════════════
  - code: SCP-008
    name: Draws and Guarantees Policy
    category: Financial Controls
    requirements:
      - id: R-008-01
        name: Recoverable Draw Governance
        description: Legal review for recoverable draws
        severity: CRITICAL
        detection:
          positivePatterns:
            - "recoverable"
            - "repay.*draw"
          negativePatterns:
            - "non-recoverable"
          requiredElements:
            - name: legal_review_required
              type: boolean
            - name: state_law_check
              type: boolean
            - name: written_consent
              type: boolean
        scoring:
          A: "Legal review + state law check + written consent for recoverable draws"
          B: "Has draw provisions but missing governance controls"
          C: "No draw governance policy"
        insertionPoint: "Section: Draw Payments"

  # ═══════════════════════════════════════════════════════════════════════════
  # SCP-009: LEAVE OF ABSENCE POLICY
  # ═══════════════════════════════════════════════════════════════════════════
  - code: SCP-009
    name: Leave of Absence Policy
    category: Legal Compliance
    requirements:
      - id: R-009-01
        name: FMLA Compliance
        description: FMLA-compliant leave provisions
        severity: CRITICAL
        detection:
          positivePatterns:
            - "FMLA"
            - "Family.*Medical.*Leave"
          requiredElements:
            - name: fmla_language
              type: boolean
            - name: military_leave
              type: boolean
        scoring:
          A: "FMLA and military leave provisions with quota pro-ration"
          B: "Generic leave language, no FMLA specifics"
          C: "No leave of absence policy"
        insertionPoint: "New Section: Leave of Absence"

  # ═══════════════════════════════════════════════════════════════════════════
  # SCP-010: MID-PERIOD CHANGES POLICY
  # ═══════════════════════════════════════════════════════════════════════════
  - code: SCP-010
    name: Mid-Period Changes Policy
    category: Compliance
    requirements:
      - id: R-010-01
        name: No Retroactive Changes
        description: Prohibit retroactive changes except for errors
        severity: HIGH
        detection:
          positivePatterns:
            - "prospective.*only"
            - "no.*retroactive"
          negativePatterns:
            - "change.*anytime"
            - "retroactive.*allowed"
          requiredElements:
            - name: prospective_only
              type: boolean
            - name: error_exception
              type: boolean
            - name: crb_approval
              type: boolean
        scoring:
          A: "Explicit prospective-only with CRB approval for plan design changes"
          B: "Mentions stability but allows broad discretionary changes"
          C: "Says 'change anytime' with no governance"
        insertionPoint: "Section: Modifications to the Plan"

  # ═══════════════════════════════════════════════════════════════════════════
  # ADDITIONAL POLICIES (SCP-011 through SCP-017)
  # Following same pattern...
  # ═══════════════════════════════════════════════════════════════════════════

# Risk Triggers
risk_triggers:
  - id: RT-001
    name: Retro/Discretion Posture
    description: Broad discretionary language increases enforceability risk
    patterns:
      - "change.*cancel.*any time"
      - "sole discretion"
      - "not subject to review.*court"
      - "company reserves the right"
    negative_match: false
    liability_impact: 1
    affected_policies: ["SCP-002", "SCP-010"]

  - id: RT-002
    name: Earned-After-Deductions
    description: Commission contingent on deductions = wage claim risk in CA
    patterns:
      - "earned only after"
      - "deemed earned.*subtracted"
      - "before.*commission is deemed earned"
    negative_match: false
    liability_impact: 2
    affected_policies: ["SCP-006", "SCP-001"]

  - id: RT-003
    name: Recoverable Draw with Termination Repayment
    description: Recoverable draw + termination repayment = high state law risk
    patterns:
      - "recoverable draw"
      - "pay back.*overdraw"
      - "repayment.*termination"
      - "overdraw.*death"
    negative_match: false
    liability_impact: 2
    affected_policies: ["SCP-006", "SCP-008", "SCP-012"]

  - id: RT-004
    name: AR Deductions
    description: AR deductions from commissions = wage law risk
    patterns:
      - "AR.*deduct"
      - "unpaid invoice.*subtract"
      - "accounts receivable.*commission"
    negative_match: false
    liability_impact: 1
    affected_policies: ["SCP-001", "SCP-006"]

  - id: RT-005
    name: No Dispute Timeline
    description: Missing dispute timeline = inconsistent handling risk
    patterns:
      - "!dispute.*days"
      - "!appeal.*days"
    negative_match: true
    liability_impact: 1
    affected_policies: ["SCP-015"]

  - id: RT-006
    name: Spiff Employment Requirement
    description: Employment requirement for earned incentives = state law risk
    patterns:
      - "must be employed.*spiff"
      - "employed at.*time.*award"
      - "active.*time.*payment"
    negative_match: false
    liability_impact: 1
    affected_policies: ["SCP-009", "SCP-012"]

# Jurisdictions
jurisdictions:
  - code: CA
    name: California
    base_multiplier: 1.5
    wage_flags:
      - final_pay_immediate
      - written_agreement_required
      - deduction_consent_strict
      - earned_on_close_not_payment
      - clawback_limits

  - code: NY
    name: New York
    base_multiplier: 1.2
    wage_flags:
      - final_pay_next_payday
      - deduction_consent_required

  - code: DEFAULT
    name: Other States
    base_multiplier: 1.0
    wage_flags: []
