module.exports=[61425,e=>{"use strict";var t=e.i(47909),a=e.i(74017),i=e.i(96250),n=e.i(59756),r=e.i(61916),o=e.i(74677),s=e.i(69741),c=e.i(16795),l=e.i(87718),p=e.i(95169),d=e.i(47587),m=e.i(66012),u=e.i(70101),g=e.i(74838),C=e.i(10372),A=e.i(93695);e.i(52474);var E=e.i(220),y=e.i(89171);async function h(e){console.log("[SGM AI Signal Emitted]",{id:e.id,source:e.source,category:e.category,severity:e.severity,title:e.title,timestamp:e.emittedAt.toISOString()})}async function S(e,t="opschief"){let a=e.map(e=>(function(e,t="opschief"){return{id:e.id||`signal_${Date.now()}`,source:t,category:({alert:"pipeline_risk",warning:"team_capacity",info:"opportunity"})[e.type]||"opportunity",severity:({critical:"critical",high:"high",medium:"medium",low:"low"})[e.severity]||"medium",title:e.title,description:e.description,metadata:e,suggestedAction:e.suggestedAction,affectedEntities:e.affectedEntities||[],emittedAt:new Date,expiresAt:new Date(Date.now()+864e5)}})(e,t));return await Promise.all(a.map(e=>h(e))),a}var v=e.i(69115),R=e.i(51283),T=e.i(79153),f=e.i(58042);let P=[{id:"audit-001",timestamp:"2025-12-17T11:00:00.000Z",eventType:"CASE_UPDATED",category:"CASE",actor:"Amanda Foster",actorRole:"VP Sales Operations",targetType:"CASE",targetId:"case-001",targetName:"CASE-2025-1201",action:"Escalated to CRB",description:"Territory change case escalated to CRB for review. Recommending $30K quota relief.",metadata:{caseType:"TERRITORY_CHANGE",financialImpact:3e4,recommendation:"Approve quota relief"},impactLevel:"HIGH",committee:"CRB"},{id:"audit-002",timestamp:"2025-12-16T15:00:00.000Z",eventType:"CASE_OPENED",category:"CASE",actor:"Thomas Anderson",actorRole:"Account Executive",targetType:"CASE",targetId:"case-007",targetName:"CASE-2025-1267",action:"Exception Request Submitted",description:"Draw repayment extension requested due to financial hardship. 3-month extension sought.",metadata:{caseType:"EXCEPTION",financialImpact:18e3,outstandingBalance:18e3},impactLevel:"MEDIUM",committee:"SGCC"},{id:"audit-003",timestamp:"2025-12-15T14:30:00.000Z",eventType:"APPROVAL_DECIDED",category:"APPROVAL",actor:"Michael Rodriguez",actorRole:"CFO (Vice Chair)",targetType:"APPROVAL",targetId:"approval-001",targetName:"Mid-Period Plan Change Policy - v2.0",action:"Approved",description:"CFO approved Mid-Period Plan Change Policy v2.0. Financial impact is acceptable.",metadata:{approvalType:"POLICY",documentCode:"SCP-017",committee:"SGCC"},impactLevel:"HIGH",committee:"SGCC"},{id:"audit-004",timestamp:"2025-12-15T10:00:00.000Z",eventType:"APPROVAL_SUBMITTED",category:"APPROVAL",actor:"Sarah Chen",actorRole:"VP Sales Compensation",targetType:"APPROVAL",targetId:"approval-001",targetName:"Mid-Period Plan Change Policy - v2.0",action:"Submitted for SGCC Approval",description:"New policy governing mid-year compensation plan changes submitted to SGCC for review.",metadata:{approvalType:"POLICY",documentCode:"SCP-017",committee:"SGCC",sla:"30 business days"},impactLevel:"HIGH",committee:"SGCC"},{id:"audit-005",timestamp:"2025-12-14T09:00:00.000Z",eventType:"CASE_OPENED",category:"CASE",actor:"Michael Torres",actorRole:"VP Sales",targetType:"CASE",targetId:"case-005",targetName:"CASE-2025-1256",action:"Plan Modification Request",description:"BDR to AE role transition requested for Christina Park, effective Jan 1.",metadata:{caseType:"PLAN_MODIFICATION",affectedRep:"Christina Park",effectiveDate:"2026-01-01"},impactLevel:"MEDIUM",committee:"SGCC"},{id:"audit-006",timestamp:"2025-12-12T09:00:00.000Z",eventType:"APPROVAL_SUBMITTED",category:"APPROVAL",actor:"Amanda Foster",actorRole:"VP Sales Operations",targetType:"APPROVAL",targetId:"approval-002",targetName:"Windfall Deal - Acme Corp $2.5M ARR",action:"Submitted to CRB",description:"Large enterprise deal submitted for windfall review. $2.5M ARR, $180K commission payout.",metadata:{approvalType:"WINDFALL",dealId:"OPP-2025-1247",dealAmount:25e5,commissionAmount:18e4,repName:"James Martinez"},impactLevel:"CRITICAL",committee:"CRB"},{id:"audit-007",timestamp:"2025-12-11T10:15:00.000Z",eventType:"APPROVAL_DECIDED",category:"APPROVAL",actor:"Sarah Chen",actorRole:"SGCC Chair",targetType:"APPROVAL",targetId:"approval-003",targetName:"Q1 2026 New Product Launch SPIF",action:"Approved",description:"Product launch SPIF approved. $40K budget, $500 per qualified deal.",metadata:{approvalType:"SPIF",budget:4e4,incentivePerDeal:500,product:"Jamf Protect Enterprise"},impactLevel:"MEDIUM",committee:"SGCC"},{id:"audit-008",timestamp:"2025-12-10T14:00:00.000Z",eventType:"APPROVAL_SUBMITTED",category:"APPROVAL",actor:"Lisa Park",actorRole:"Sales Compensation Manager",targetType:"APPROVAL",targetId:"approval-003",targetName:"Q1 2026 New Product Launch SPIF",action:"Submitted for Approval",description:"Product launch incentive for Jamf Protect Enterprise submitted to SGCC. $40K budget.",metadata:{approvalType:"SPIF",budget:4e4,committee:"SGCC"},impactLevel:"MEDIUM",committee:"SGCC"},{id:"audit-009",timestamp:"2025-12-09T15:00:00.000Z",eventType:"CASE_RESOLVED",category:"CASE",actor:"Lisa Park",actorRole:"Sales Compensation Manager",targetType:"CASE",targetId:"case-003",targetName:"CASE-2025-1245",action:"Case Resolved - Approved",description:"SPIF eligibility exception approved. $500 credit added to Q4 commission run.",metadata:{caseType:"EXCEPTION",decision:"APPROVED",financialImpact:500},impactLevel:"LOW"},{id:"audit-010",timestamp:"2025-12-09T11:00:00.000Z",eventType:"EXCEPTION_GRANTED",category:"CASE",actor:"Sarah Chen",actorRole:"VP Sales Compensation",targetType:"CASE",targetId:"case-003",targetName:"CASE-2025-1245",action:"Exception Approved",description:"Retroactive SPIF eligibility granted to Jennifer Martinez. Deal meets all criteria.",metadata:{caseType:"EXCEPTION",affectedRep:"Jennifer Martinez",amount:500},impactLevel:"LOW"},{id:"audit-011",timestamp:"2025-12-08T09:30:00.000Z",eventType:"CASE_OPENED",category:"CASE",actor:"Mark Stevens",actorRole:"Regional Sales Manager",targetType:"CASE",targetId:"case-001",targetName:"CASE-2025-1201",action:"Territory Change Case Submitted",description:"Mid-quarter territory reassignment case filed for Lisa Johnson. $30K quota adjustment requested.",metadata:{caseType:"TERRITORY_CHANGE",affectedRep:"Lisa Johnson",financialImpact:3e4},impactLevel:"HIGH",committee:"CRB"},{id:"audit-012",timestamp:"2025-12-02T15:30:00.000Z",eventType:"APPROVAL_DECIDED",category:"APPROVAL",actor:"Patricia Garcia",actorRole:"Director of Finance",targetType:"APPROVAL",targetId:"approval-007",targetName:"Windfall Deal - TechStart Inc",action:"Approved with Cap",description:"CRB approved windfall deal with commission cap at $80K (2x monthly target).",metadata:{approvalType:"WINDFALL",dealId:"OPP-2025-1189",originalCommission:95e3,cappedCommission:8e4,decision:"Commission Cap"},impactLevel:"HIGH",committee:"CRB"},{id:"audit-013",timestamp:"2025-12-02T15:00:00.000Z",eventType:"APPROVAL_DECIDED",category:"APPROVAL",actor:"Sarah Chen",actorRole:"CRB Chair",targetType:"APPROVAL",targetId:"approval-007",targetName:"Windfall Deal - TechStart Inc",action:"Approved with Cap",description:"Deal is legitimate but payout is 2.5x target. Applying commission cap at $80K.",metadata:{approvalType:"WINDFALL",dealId:"OPP-2025-1189",decision:"Commission Cap",cappedAmount:8e4},impactLevel:"HIGH",committee:"CRB"},{id:"audit-014",timestamp:"2025-11-28T14:00:00.000Z",eventType:"DISPUTE_FILED",category:"CASE",actor:"Marcus Williams",actorRole:"Account Executive",targetType:"CASE",targetId:"case-002",targetName:"CASE-2025-1189",action:"Commission Dispute Filed",description:"Dispute filed regarding Q3 commission calculation on multi-year deal. $42K disputed.",metadata:{caseType:"DISPUTE",financialImpact:42e3,dealId:"OPP-2025-0987"},impactLevel:"MEDIUM",committee:"CRB"},{id:"audit-015",timestamp:"2025-11-22T16:00:00.000Z",eventType:"CASE_RESOLVED",category:"CASE",actor:"Amanda Foster",actorRole:"VP Sales Operations",targetType:"CASE",targetId:"case-004",targetName:"CASE-2025-1178",action:"Case Closed - Approved",description:"New hire ramp extension approved. Quota updated in system.",metadata:{caseType:"QUOTA_ADJUSTMENT",decision:"APPROVED",affectedRep:"Robert Chen"},impactLevel:"MEDIUM"},{id:"audit-016",timestamp:"2025-11-22T14:00:00.000Z",eventType:"EXCEPTION_GRANTED",category:"CASE",actor:"Sarah Chen",actorRole:"SGCC Chair",targetType:"CASE",targetId:"case-004",targetName:"CASE-2025-1178",action:"SGCC Approval",description:"Ramp extension approved for Robert Chen. Extended onboarding justified.",metadata:{caseType:"QUOTA_ADJUSTMENT",affectedRep:"Robert Chen",rampExtension:"1 month at 75%"},impactLevel:"MEDIUM",committee:"SGCC"},{id:"audit-017",timestamp:"2025-11-20T09:00:00.000Z",eventType:"APPROVAL_SUBMITTED",category:"APPROVAL",actor:"Amanda Foster",actorRole:"VP Sales Operations",targetType:"APPROVAL",targetId:"approval-007",targetName:"Windfall Deal - TechStart Inc",action:"Submitted to CRB",description:"Mid-market deal submitted for windfall review. $1.2M ARR, $95K commission.",metadata:{approvalType:"WINDFALL",dealId:"OPP-2025-1189",dealAmount:12e5,commissionAmount:95e3,repName:"Sarah Williams"},impactLevel:"HIGH",committee:"CRB"},{id:"audit-018",timestamp:"2025-11-15T13:00:00.000Z",eventType:"CASE_OPENED",category:"CASE",actor:"Angela Davis",actorRole:"Sales Manager",targetType:"CASE",targetId:"case-004",targetName:"CASE-2025-1178",action:"Quota Adjustment Request",description:"New hire ramp extension requested for Robert Chen. Delayed territory handoff.",metadata:{caseType:"QUOTA_ADJUSTMENT",affectedRep:"Robert Chen",financialImpact:15e3},impactLevel:"MEDIUM",committee:"SGCC"},{id:"audit-019",timestamp:"2025-10-28T15:00:00.000Z",eventType:"CASE_RESOLVED",category:"CASE",actor:"Lisa Park",actorRole:"Sales Compensation Manager",targetType:"CASE",targetId:"case-006",targetName:"CASE-2025-1098",action:"Case Closed - Denied",description:"Commission dispute denied. SE role does not qualify for split credit per plan.",metadata:{caseType:"DISPUTE",decision:"DENIED",affectedRep:"David Park"},impactLevel:"LOW"},{id:"audit-020",timestamp:"2025-10-28T11:00:00.000Z",eventType:"APPROVAL_DECIDED",category:"CASE",actor:"Amanda Foster",actorRole:"VP Sales Operations",targetType:"CASE",targetId:"case-006",targetName:"CASE-2025-1098",action:"Dispute Denied",description:"Split credit request denied. SE compensation plan does not include split provisions.",metadata:{caseType:"DISPUTE",decision:"DENIED",affectedRep:"David Park",financialImpact:8e3},impactLevel:"LOW"},{id:"audit-021",timestamp:"2025-10-15T10:00:00.000Z",eventType:"DISPUTE_FILED",category:"CASE",actor:"David Park",actorRole:"Solutions Engineer",targetType:"CASE",targetId:"case-006",targetName:"CASE-2025-1098",action:"Dispute Filed",description:"Q2 attainment dispute filed. Requesting split credit for support activity.",metadata:{caseType:"DISPUTE",financialImpact:8e3},impactLevel:"LOW"},{id:"audit-022",timestamp:"2025-01-01T00:00:00.000Z",eventType:"POLICY_EFFECTIVE",category:"POLICY",actor:"System",actorRole:"System",targetType:"DOCUMENT",targetId:"doc-001",targetName:"GC-001 SGCC Charter",action:"Policy Became Effective",description:"Sales Compensation Governance Committee Charter became effective.",metadata:{documentCode:"GC-001",documentType:"FRAMEWORK",version:"1.0"},impactLevel:"CRITICAL",committee:"SGCC"}];function I(e){console.log("[SGM Telemetry]",JSON.stringify(e,null,2))}async function D(e){try{let t,a,i,n=e.nextUrl.searchParams,r=n.get("tenantId")||"platform",o=n.get("department");n.get("forceRefresh");let s=R.APPROVAL_ITEMS.filter(e=>"PENDING"===e.status),c=R.APPROVAL_ITEMS.filter(e=>"AT_RISK"===e.slaStatus),l=f.CASE_ITEMS.filter(e=>"UNDER_REVIEW"===e.status||"PENDING_INFO"===e.status||"ESCALATED"===e.status),p=T.ALL_GOVERNANCE_DOCUMENTS.filter(e=>"POLICY"===e.documentType),d=P[0],m=T.ALL_GOVERNANCE_DOCUMENTS.length,u=T.ALL_GOVERNANCE_DOCUMENTS.filter(e=>"APPROVED"===e.status).length,g=T.ALL_GOVERNANCE_DOCUMENTS.filter(e=>"DRAFT"===e.status).length,C=`You are OpsChief, an AI governance assistant for the Sales Governance Manager (SGM) SPARCC platform.

## Current Governance Snapshot
**Total Documents**: ${m} (${u} approved, ${g} draft)
**Pending Approvals**: ${s.length}
**SLA At Risk**: ${c.length}
**Active Cases**: ${l.length}
**Active Policies**: ${p.length}
**Last Governance Activity**: ${d?.timestamp||"N/A"}

## Pending Approvals Requiring Attention
${s.slice(0,5).map(e=>`
- **${e.documentCode||e.type}**: ${e.title}
  - Committee: ${e.committee}
  - SLA Status: ${e.slaStatus}
  - Submitted: ${e.requestedAt}
  - Priority: ${e.priority}
`).join("")}

## Active Cases
${l.slice(0,3).map(e=>`
- **${e.caseNumber}**: ${e.title}
  - Type: ${e.type}
  - Priority: ${e.priority}
  - Status: ${e.status}
`).join("")}

## Your Role
Analyze this governance data and identify:
1. **Alerts** (ðŸš¨) - Critical governance issues requiring immediate attention
2. **Warnings** (âš ï¸) - At-risk situations that need monitoring
3. **Info** (â„¹ï¸) - Positive updates and governance health indicators

## Analysis Framework
**Approval Velocity**: SLA compliance, bottlenecks in approval workflows
**Compliance Health**: Policy coverage, expiring documents, audit findings
**Case Management**: Dispute resolution time, exception request volume
**Policy Governance**: Version control, effective dating, ownership clarity
**Risk Indicators**: SLA breaches, unapproved policies, compliance gaps

## Output Format
Return valid JSON array with this structure (NO markdown, pure JSON):
[
  {
    "id": "insight_1",
    "type": "alert|warning|info",
    "title": "Brief title",
    "description": "Actionable description with specific metrics",
    "severity": "critical|high|medium|low",
    "actionable": true|false,
    "suggestedAction": "Specific action to take"
  }
]

Generate 3-5 governance insights based on the data above. Be specific with metrics and actionable recommendations.`,A=Date.now();if((0,v.isRallyLLMConfigured)()){let e=(0,v.getRallyLLMClient)(),n=e.getStatus();console.log(`ðŸ”§ [OpsChief/SGM] Using LLM: ${n.model} (Rally)`);let r=await e.chat([{role:"user",content:C}],{maxTokens:2048,temperature:.5});t=r.content,a=n.model,i=r.tokensUsed}else{console.log(`ðŸ”§ [OpsChief/SGM] Using LLM: Claude 3.5 Sonnet (Fallback)`);let e=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":process.env.ANTHROPIC_API_KEY||"","anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-opus-4-5-20251101",max_tokens:2048,temperature:.5,messages:[{role:"user",content:C}]})});if(!e.ok){let t=await e.text();throw Error(`Claude API error: ${e.status} - ${t}`)}let n=await e.json();t=n.content?.[0]?.text||"",a="claude-opus-4-5-20251101",i={input:n.usage?.input_tokens||0,output:n.usage?.output_tokens||0,total:(n.usage?.input_tokens||0)+(n.usage?.output_tokens||0)}}let E=Date.now();if(!t)throw Error("LLM returned empty content");let h=[];try{let e=t.match(/\[[\s\S]*\]/);e&&(h=JSON.parse(e[0]).map((e,t)=>({id:e.id||`insight_${t}`,type:e.type||"info",title:e.title||"Update",description:e.description||"",timestamp:new Date,severity:e.severity||"medium",actionable:!1!==e.actionable,suggestedAction:e.suggestedAction})))}catch(e){console.error("Failed to parse insights JSON:",e),h=[{id:"insight_0",type:"info",title:"Governance Analysis Complete",description:t.substring(0,200),timestamp:new Date,severity:"low",actionable:!1}]}I({name:"ai.request",appId:"sgm-sparcc",tenantId:r,ts:new Date().toISOString(),metrics:{modelId:a,modelType:(0,v.isRallyLLMConfigured)()?"rally-llama-spm":"claude-sonnet",intent:"sgm_governance_analysis",analysisType:"opschief",department:o||"all",inputTokens:i.input}}),I({name:"ai.response",appId:"sgm-sparcc",tenantId:r,ts:new Date().toISOString(),metrics:{insightCount:h.length,documentsAnalyzed:m,pendingApprovals:s.length,activeCases:l.length,responseTime:`${E-A}ms`,outputTokens:i.output,totalTokens:i.total,success:!0}});let D=await S(h,"opschief");return I({name:"ai.signal_emitted",appId:"sgm-sparcc",tenantId:r,ts:new Date().toISOString(),metrics:{signalCount:D.length,insightCount:h.length,criticalSignals:D.filter(e=>"critical"===e.severity).length}}),console.log("OpsChief governance analysis:",{department:o||"all",insightCount:h.length,signalsEmitted:D.length,documentsAnalyzed:m,pendingApprovals:s.length,activeCases:l.length}),y.NextResponse.json({insights:h,signals:D.map(e=>({id:e.id,category:e.category,severity:e.severity,title:e.title})),generatedAt:new Date().toISOString(),nextRefresh:new Date(Date.now()+36e5).toISOString(),metadata:{documentsAnalyzed:m,pendingApprovals:s.length,activeCases:l.length,department:o||"all",signalsEmitted:D.length}})}catch(t){console.error("OpsChief/SGM error:",t);let e=t instanceof Error?t.message:"Unknown error occurred";return I({name:"api.error",appId:"sgm-sparcc",tenantId:"platform",ts:new Date().toISOString(),metrics:{endpoint:"/api/ai/opschief",errorClass:t instanceof Error?t.name:"UNKNOWN",statusCode:500}}),y.NextResponse.json({error:"Failed to generate governance insights",details:e,insights:[]},{status:500})}}P.length,P.filter(e=>{let t=new Date(e.timestamp),a=new Date;return a.setDate(a.getDate()-1),t>a}).length,P.filter(e=>{let t=new Date(e.timestamp),a=new Date;return a.setDate(a.getDate()-7),t>a}).length,P.filter(e=>"DOCUMENT"===e.category).length,P.filter(e=>"APPROVAL"===e.category).length,P.filter(e=>"CASE"===e.category).length,P.filter(e=>"COMMITTEE"===e.category).length,P.filter(e=>"POLICY"===e.category).length,P.filter(e=>"ACCESS"===e.category).length,P.filter(e=>"CRITICAL"===e.impactLevel).length,P.filter(e=>"HIGH"===e.impactLevel).length,P.filter(e=>"MEDIUM"===e.impactLevel).length,P.filter(e=>"LOW"===e.impactLevel).length,e.s(["GET",()=>D],64459);var O=e.i(64459);let L=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/ai/opschief/route",pathname:"/api/ai/opschief",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/ai/opschief/route.ts",nextConfigOutput:"standalone",userland:O}),{workAsyncStorage:N,workUnitAsyncStorage:w,serverHooks:M}=L;function _(){return(0,i.patchFetch)({workAsyncStorage:N,workUnitAsyncStorage:w})}async function b(e,t,i){L.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/ai/opschief/route";y=y.replace(/\/index$/,"")||"/";let h=await L.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!h)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:S,params:v,nextConfig:R,parsedUrl:T,isDraftMode:f,prerenderManifest:P,routerServerContext:I,isOnDemandRevalidate:D,revalidateOnlyGenerated:O,resolvedPathname:N,clientReferenceManifest:w,serverActionsManifest:M}=h,_=(0,s.normalizeAppPath)(y),b=!!(P.dynamicRoutes[_]||P.routes[N]),x=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,T,!1):t.end("This page could not be found"),null);if(b&&!f){let e=!!P.routes[N],t=P.dynamicRoutes[_];if(t&&!1===t.fallback&&!e){if(R.experimental.adapterPath)return await x();throw new A.NoFallbackError}}let G=null;!b||L.isDev||f||(G="/index"===(G=N)?"/":G);let U=!0===L.isDev||!b,V=b&&!U;M&&w&&(0,o.setManifestsSingleton)({page:y,clientReferenceManifest:w,serverActionsManifest:M});let $=e.method||"GET",k=(0,r.getTracer)(),F=k.getActiveScopeSpan(),H={params:v,prerenderManifest:P,renderOpts:{experimental:{authInterrupts:!!R.experimental.authInterrupts},cacheComponents:!!R.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:R.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,i,n)=>L.onRequestError(e,t,i,n,I)},sharedContext:{buildId:S}},q=new c.NodeNextRequest(e),B=new c.NodeNextResponse(t),Z=l.NextRequestAdapter.fromNodeNextRequest(q,(0,l.signalFromNodeResponse)(t));try{let o=async e=>L.handle(Z,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=k.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=a.get("next.route");if(i){let t=`${$} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${$} ${y}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),c=async n=>{var r,c;let l=async({previousCacheEntry:a})=>{try{if(!s&&D&&O&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await o(n);e.fetchMetrics=H.renderOpts.fetchMetrics;let c=H.renderOpts.pendingWaitUntil;c&&i.waitUntil&&(i.waitUntil(c),c=void 0);let l=H.renderOpts.collectedTags;if(!b)return await (0,m.sendResponse)(q,B,r,H.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,u.toNodeOutgoingHttpHeaders)(r.headers);l&&(t[C.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=C.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,i=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=C.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:i}}}}catch(t){throw(null==a?void 0:a.isStale)&&await L.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:V,isOnDemandRevalidate:D})},!1,I),t}},p=await L.handleResponse({req:e,nextConfig:R,cacheKey:G,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:P,isRoutePPREnabled:!1,isOnDemandRevalidate:D,revalidateOnlyGenerated:O,responseGenerator:l,waitUntil:i.waitUntil,isMinimalMode:s});if(!b)return null;if((null==p||null==(r=p.value)?void 0:r.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(c=p.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",D?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),f&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let A=(0,u.fromNodeOutgoingHttpHeaders)(p.value.headers);return s&&b||A.delete(C.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||A.get("Cache-Control")||A.set("Cache-Control",(0,g.getCacheControlHeader)(p.cacheControl)),await (0,m.sendResponse)(q,B,new Response(p.value.body,{headers:A,status:p.value.status||200})),null};F?await c(F):await k.withPropagatedContext(e.headers,()=>k.trace(p.BaseServerSpan.handleRequest,{spanName:`${$} ${y}`,kind:r.SpanKind.SERVER,attributes:{"http.method":$,"http.target":e.url}},c))}catch(t){if(t instanceof A.NoFallbackError||await L.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:V,isOnDemandRevalidate:D})},!1,I),b)throw t;return await (0,m.sendResponse)(q,B,new Response(null,{status:500})),null}}e.s(["handler",()=>b,"patchFetch",()=>_,"routeModule",()=>L,"serverHooks",()=>M,"workAsyncStorage",()=>N,"workUnitAsyncStorage",()=>w],61425)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_1fcccb22.js.map