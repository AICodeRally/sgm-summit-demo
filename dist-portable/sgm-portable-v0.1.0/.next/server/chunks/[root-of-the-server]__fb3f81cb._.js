module.exports=[93695,(e,t,n)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70406,(e,t,n)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,n)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},63021,(e,t,n)=>{t.exports=e.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},16496,e=>{"use strict";let t;function n(){let t;if("synthetic"===(process.env.BINDING_MODE||"synthetic"))throw Error("Cannot access Prisma client in synthetic mode. Use in-memory providers instead.");if(!process.env.DATABASE_URL)throw Error("DATABASE_URL is required for live binding mode. Set BINDING_MODE=synthetic to use in-memory providers.");if(!((t=process.env.DATABASE_URL)&&t.includes("schema=sgm_summit_demo")))throw Error("DATABASE_URL must include &schema=sgm_summit_demo for proper schema isolation.\nExample: postgresql://user:pass@host:5432/db?sslmode=require&schema=sgm_summit_demo");if(global.prisma)return global.prisma;let{PrismaClient:n}=e.r(63021);return new n({log:["error"]})}let o=new Proxy({},{get:(e,o)=>(t||(t=n()),t[o])});async function a(){global.prisma&&(await global.prisma.$disconnect(),global.prisma=void 0)}e.s(["disconnectPrisma",()=>a,"getPrismaClient",()=>n,"prisma",0,o])},79153,e=>{"use strict";let t=[{documentCode:"GC-001",title:"Sales Compensation Governance Committee Charter",documentType:"FRAMEWORK",category:"Governance",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"VP Sales Compensation",description:"SGCC committee structure, authority, and decision-making framework. Establishes 7-member committee with approval thresholds and meeting cadence."},{documentCode:"CRB-001",title:"Compensation Review Board Charter",documentType:"FRAMEWORK",category:"Governance",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"VP Sales Compensation",description:"CRB authority for windfall deals ($1M+), exceptions, and SPIF approvals. Defines 6 decision options for large deals."},{documentCode:"FWK-003",title:"Sales Segment & Role Classification Framework",documentType:"FRAMEWORK",category:"Plan Design",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Plan types, segment definitions, and role assignments across Enterprise, Mid-Market, and SMB segments."},{documentCode:"FWK-004",title:"Territory & Quota Management Framework",documentType:"FRAMEWORK",category:"Territory Management",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Territory rules, quota methodology, adjustment processes, and appeals framework."},{documentCode:"FWK-005",title:"Commission Metrics Framework",documentType:"FRAMEWORK",category:"Metrics",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"All compensation metrics defined: GARR, Net New ARR, Deal Registration, MBO/SPIFs, accelerators."},{documentCode:"FWK-006",title:"SPIF & Kicker Governance Framework",documentType:"FRAMEWORK",category:"SPIFs",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"SPIF types (Product Launch, Vertical, Seasonal), approval authority by budget tier, and tracking requirements."},{documentCode:"FWK-007",title:"Standard Taxonomy & Definitions Dictionary",documentType:"FRAMEWORK",category:"Reference",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Comprehensive glossary of compensation terms, SPARCC-specific language, and metric definitions."}],n=[{documentCode:"SCP-001",title:"Sales Crediting Policy",documentType:"POLICY",category:"Crediting",status:"APPROVED",version:"2.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Deal crediting rules for new logo, named accounts, renewals, and multi-rep splits. Includes SE allocation rules."},{documentCode:"SCP-002",title:"Quota Setting & Mid-Period Change Policy",documentType:"POLICY",category:"Quota Management",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Annual quota setting methodology, mid-year adjustment rules, and quota appeal process."},{documentCode:"SCP-003",title:"Payment Timing & Draw Policy",documentType:"POLICY",category:"Payments",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Finance",description:"Commission payment schedule, draw eligibility, and repayment terms for new hires."},{documentCode:"SCP-004",title:"Termination & Severance Policy",documentType:"POLICY",category:"Employment",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"HR",description:"Commission treatment on voluntary termination, involuntary termination, and severance scenarios."},{documentCode:"SCP-005",title:"Leave of Absence Policy",documentType:"POLICY",category:"Employment",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"HR",description:"Commission treatment during medical leave, parental leave, and extended absences."},{documentCode:"SCP-006",title:"Territory Change Policy",documentType:"POLICY",category:"Territory Management",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Rules for territory reassignments, protection periods, and transition credits."},{documentCode:"SCP-007",title:"Windfall & Large Deal Policy",documentType:"POLICY",category:"Large Deals",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"CRB",description:"Windfall identification criteria ($1M ARR, $100K+ payout) and CRB review process with 6 decision options."},{documentCode:"SCP-008",title:"SPIF Governance Policy",documentType:"POLICY",category:"SPIFs",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"SPIF approval thresholds: <$50K (SGCC), $50-250K (SGCC+CFO), >$250K (SGCC+CEO)."},{documentCode:"SCP-009",title:"Clawback & Recovery Policy",documentType:"POLICY",category:"Compliance",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Finance",description:"Overpayment recovery procedures, clawback triggers, and repayment schedules."},{documentCode:"SCP-010",title:"Multi-State Wage Law Compliance Policy",documentType:"POLICY",category:"Legal Compliance",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Legal",description:"State-specific wage law compliance (CA, NY, MA) for commission payments and deductions."},{documentCode:"SCP-011",title:"Section 409A Compliance Policy",documentType:"POLICY",category:"Tax Compliance",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Legal",description:"IRS Section 409A compliance for deferred commission and long-term incentives."},{documentCode:"SCP-012",title:"Data Retention Policy",documentType:"POLICY",category:"Data Governance",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Legal",description:"7-year retention for compensation records, calculations, and dispute documentation."},{documentCode:"SCP-013",title:"Version Control & Document Management Policy",documentType:"POLICY",category:"Governance",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Document versioning standards, approval workflows, and superseded document handling."},{documentCode:"SCP-014",title:"Standard Terms & Conditions",documentType:"POLICY",category:"Legal",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Legal",description:"Master T&Cs for all compensation plans including at-will employment language."},{documentCode:"SCP-015",title:"Cap & Threshold Guidelines",documentType:"POLICY",category:"Plan Design",status:"DRAFT",version:"0.9",effectiveDate:null,owner:"Sales Compensation",description:"Financial limits, acceleration caps, and attainment thresholds by role."},{documentCode:"SCP-016",title:"Draws & Guarantees Policy",documentType:"POLICY",category:"Payments",status:"DRAFT",version:"0.8",effectiveDate:null,owner:"Finance",description:"Draw request process, guarantee terms, and repayment obligations."},{documentCode:"SCP-017",title:"Mid-Period Plan Change Policy",documentType:"POLICY",category:"Plan Changes",status:"UNDER_REVIEW",version:"0.9",effectiveDate:null,owner:"Sales Compensation",description:"Rules for making plan changes mid-year including grandfathering and transition rules."}],o=[{documentCode:"PROC-001",title:"Quota Setting Procedures",documentType:"PROCEDURE",category:"Quota Management",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Step-by-step annual quota setting process including top-down allocation and rep-level assignment."},{documentCode:"PROC-002",title:"Territory Change Procedures",documentType:"PROCEDURE",category:"Territory Management",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Territory reassignment workflow including notification, transition period, and credit protection."},{documentCode:"PROC-003",title:"Sales Crediting Rules Documentation",documentType:"PROCEDURE",category:"Crediting",status:"APPROVED",version:"2.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Detailed crediting examples for all deal types with SE allocation matrices."},{documentCode:"PROC-004",title:"New Hire Onboarding Process",documentType:"PROCEDURE",category:"Onboarding",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"HR",description:"Compensation onboarding checklist including plan assignment, quota setting, and training."},{documentCode:"PROC-005",title:"Transfer & Promotion Procedures",documentType:"PROCEDURE",category:"Career Movement",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"HR",description:"Plan changes on internal transfers and promotions with protection rules."},{documentCode:"PROC-006",title:"Commission Reconciliation Procedures",documentType:"PROCEDURE",category:"Reconciliation",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Finance",description:"Month-end reconciliation process including data validation and variance investigation."},{documentCode:"PROC-007",title:"Pre-Payment Validation Checklist",documentType:"PROCEDURE",category:"Quality Control",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Finance",description:"Quality control gates before commission payout including audit checks."},{documentCode:"PROC-008",title:"Dispute Resolution Procedures",documentType:"PROCEDURE",category:"Disputes",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Escalation path for disputes: Manager → Sales Ops → CRB → SGCC with SLAs."},{documentCode:"PROC-009",title:"Exception Request Process",documentType:"PROCEDURE",category:"Exceptions",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"How to request exceptions including required documentation and approval routing."},{documentCode:"PROC-010",title:"Calculation Documentation Standard",documentType:"PROCEDURE",category:"Documentation",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Standard templates for documenting commission calculations with audit trail."}],a=[{documentCode:"TPL-001",title:"SGCC Meeting Agenda Template",documentType:"TEMPLATE",category:"Meetings",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Standard agenda format for quarterly SGCC meetings."},{documentCode:"TPL-002",title:"CRB Meeting Agenda Template",documentType:"TEMPLATE",category:"Meetings",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Standard agenda for windfall deal reviews and exception approvals."},{documentCode:"TPL-003",title:"Meeting Minutes Template",documentType:"TEMPLATE",category:"Documentation",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Standard format for recording SGCC and CRB meeting minutes."},{documentCode:"TPL-004",title:"Plan Announcement Template",documentType:"TEMPLATE",category:"Communications",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Email template for announcing new compensation plans to sales team."},{documentCode:"TPL-005",title:"FAQ Template",documentType:"TEMPLATE",category:"Documentation",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Format for plan FAQs with common questions and answers."},{documentCode:"TPL-006",title:"Plan Summary Template",documentType:"TEMPLATE",category:"Plan Design",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"One-page plan summary template for rep communication."},{documentCode:"TPL-007",title:"CRB Decision Log Template",documentType:"TEMPLATE",category:"Decisions",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"CRB",description:"Standard format for recording CRB windfall decisions with rationale."},{documentCode:"TPL-008",title:"Quota Adjustment Request Form",documentType:"TEMPLATE",category:"Forms",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Form for requesting mid-year quota adjustments with justification."},{documentCode:"TPL-009",title:"Territory Change Request Form",documentType:"TEMPLATE",category:"Forms",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Request form for territory reassignments and modifications."},{documentCode:"TPL-010",title:"Exception Request Form",documentType:"TEMPLATE",category:"Forms",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"General exception request form with approval routing."},{documentCode:"TPL-011",title:"Commission Statement Template",documentType:"TEMPLATE",category:"Statements",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Finance",description:"Monthly commission statement format showing calculations and payouts."},{documentCode:"TPL-012",title:"New Plan Launch Checklist",documentType:"TEMPLATE",category:"Checklists",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"30-point checklist for launching new compensation plans."}],i=[{documentCode:"CHK-001",title:"Governance Implementation Checklist",documentType:"CHECKLIST",category:"Implementation",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"7-phase implementation checklist with 90+ tasks for rolling out governance framework."}],r=[{documentCode:"GUIDE-001",title:"Sales Rep Compensation Guide",documentType:"GUIDE",category:"Enablement",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Enablement",description:"Complete guide for sales reps covering plans, crediting, statements, and dispute resolution."},{documentCode:"GUIDE-002",title:"Sales Manager Enablement Guide",documentType:"GUIDE",category:"Enablement",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Enablement",description:"Manager guide for handling team comp questions, approving exceptions, and coaching."}],s=[...t,...n,...o,...a,...i,...r];t.length,n.length,o.length,a.length,i.length,r.length,s.length,e.s(["ALL_GOVERNANCE_DOCUMENTS",0,s])},20008,e=>{"use strict";var t=e.i(69719);let n=t.z.enum(["TEXT","TEXT_AREA","NUMBER","DECIMAL","DATE","BOOLEAN","DROPDOWN","MULTI_SELECT","EMAIL","URL","CURRENCY","PERCENTAGE"]),o=t.z.object({type:t.z.enum(["REQUIRED","MIN","MAX","PATTERN","CUSTOM"]),value:t.z.union([t.z.string(),t.z.number(),t.z.boolean()]).optional(),message:t.z.string().optional()}),a=t.z.object({fieldKey:t.z.string().max(100),label:t.z.string().max(200),type:n,description:t.z.string().max(500).optional(),placeholder:t.z.string().max(200).optional(),defaultValue:t.z.union([t.z.string(),t.z.number(),t.z.boolean(),t.z.array(t.z.string())]).optional(),options:t.z.array(t.z.object({value:t.z.string(),label:t.z.string()})).optional(),validationRules:t.z.array(o).optional(),helpText:t.z.string().max(500).optional(),orderIndex:t.z.number().int().min(0),isVisible:t.z.boolean().default(!0),metadata:t.z.record(t.z.string(),t.z.any()).optional()}),i=t.z.enum(["POLICY_EXPERT","DESIGN","UIUX","KNOWLEDGE_BASE"]),r=t.z.object({id:t.z.string().cuid(),templateId:t.z.string().cuid(),parentSectionId:t.z.string().cuid().optional(),sectionKey:t.z.string().max(100),title:t.z.string().min(1).max(200),description:t.z.string().max(2e3).optional(),orderIndex:t.z.number().int().min(0),level:t.z.number().int().min(0).max(5).default(0),isRequired:t.z.boolean().default(!1),isRepeatable:t.z.boolean().default(!1),contentTemplate:t.z.string().optional(),fieldDefinitions:t.z.array(a).optional(),aiAgentRoles:t.z.array(i).optional(),metadata:t.z.record(t.z.string(),t.z.any()).optional()}),s=r.omit({id:!0}).extend({templateId:t.z.string().cuid(),sectionKey:t.z.string().max(100),title:t.z.string().min(1).max(200),orderIndex:t.z.number().int().min(0),level:t.z.number().int().min(0).max(5).default(0),isRequired:t.z.boolean().default(!1),isRepeatable:t.z.boolean().default(!1)}),c=r.partial().required({id:!0}),d=r.extend({children:t.z.lazy(()=>d.array()).optional()});t.z.object({templateId:t.z.string().cuid(),sectionOrders:t.z.array(t.z.object({sectionId:t.z.string().cuid(),orderIndex:t.z.number().int().min(0),parentSectionId:t.z.string().cuid().optional()}))}),e.s(["CreateTemplateSectionSchema",0,s,"UpdateTemplateSectionSchema",0,c])},45521,e=>{"use strict";var t=e.i(47909),n=e.i(74017),o=e.i(96250),a=e.i(59756),i=e.i(61916),r=e.i(74677),s=e.i(69741),c=e.i(16795),d=e.i(87718),l=e.i(95169),u=e.i(47587),p=e.i(66012),m=e.i(70101),g=e.i(74838),C=e.i(10372),y=e.i(93695);e.i(52474);var f=e.i(220),P=e.i(89171);e.i(81605);var v=e.i(32750),R=e.i(20008);async function E(e,{params:t}){try{let{sectionId:e}=await t,n=(0,v.getRegistry)().getPlanTemplate(),o=await n.getSection(e);if(!o)return P.NextResponse.json({error:"Section not found"},{status:404});return P.NextResponse.json({section:o},{status:200})}catch(e){return P.NextResponse.json({error:e.message,details:e.errors||void 0},{status:400})}}async function T(e,{params:t}){try{let{id:n,sectionId:o}=await t,a=await e.json(),i=R.UpdateTemplateSectionSchema.parse({...a,id:o}),r=(0,v.getRegistry)(),s=r.getPlanTemplate(),c=r.getAudit(),d=await s.updateSection(i),l=await s.findById(n);return l&&await c.create({tenantId:l.tenantId,eventType:"update",severity:"info",message:`Template section updated: ${d.title}`,entityType:"plan_template",entityId:l.id,entityName:l.name,actorId:"system",actorName:"system"}),P.NextResponse.json({section:d},{status:200})}catch(e){return P.NextResponse.json({error:e.message,details:e.errors||void 0},{status:400})}}async function w(e,{params:t}){try{let{id:e,sectionId:n}=await t,o=(0,v.getRegistry)(),a=o.getPlanTemplate(),i=o.getAudit(),r=await a.getSection(n);if(!r)return P.NextResponse.json({error:"Section not found"},{status:404});await a.deleteSection(n);let s=await a.findById(e);return s&&await i.create({tenantId:s.tenantId,eventType:"delete",severity:"warning",message:`Template section deleted: ${r.title}`,entityType:"plan_template",entityId:s.id,entityName:s.name,actorId:"system",actorName:"system"}),P.NextResponse.json({success:!0,message:"Section deleted successfully"},{status:200})}catch(e){return P.NextResponse.json({error:e.message,details:e.errors||void 0},{status:400})}}e.s(["DELETE",()=>w,"GET",()=>E,"PUT",()=>T],92108);var D=e.i(92108);let h=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/plan-templates/[id]/sections/[sectionId]/route",pathname:"/api/plan-templates/[id]/sections/[sectionId]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/plan-templates/[id]/sections/[sectionId]/route.ts",nextConfigOutput:"standalone",userland:D}),{workAsyncStorage:S,workUnitAsyncStorage:A,serverHooks:O}=h;function x(){return(0,o.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:A})}async function I(e,t,o){h.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let P="/api/plan-templates/[id]/sections/[sectionId]/route";P=P.replace(/\/index$/,"")||"/";let v=await h.prepare(e,t,{srcPage:P,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:R,params:E,nextConfig:T,parsedUrl:w,isDraftMode:D,prerenderManifest:S,routerServerContext:A,isOnDemandRevalidate:O,revalidateOnlyGenerated:x,resolvedPathname:I,clientReferenceManifest:b,serverActionsManifest:L}=v,M=(0,s.normalizeAppPath)(P),z=!!(S.dynamicRoutes[M]||S.routes[I]),V=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,w,!1):t.end("This page could not be found"),null);if(z&&!D){let e=!!S.routes[I],t=S.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await V();throw new y.NoFallbackError}}let N=null;!z||h.isDev||D||(N="/index"===(N=I)?"/":N);let F=!0===h.isDev||!z,U=z&&!F;L&&b&&(0,r.setManifestsSingleton)({page:P,clientReferenceManifest:b,serverActionsManifest:L});let k=e.method||"GET",q=(0,i.getTracer)(),_=q.getActiveScopeSpan(),j={params:E,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:F,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,o,a)=>h.onRequestError(e,t,o,a,A)},sharedContext:{buildId:R}},G=new c.NodeNextRequest(e),K=new c.NodeNextResponse(t),B=d.NextRequestAdapter.fromNodeNextRequest(G,(0,d.signalFromNodeResponse)(t));try{let r=async e=>h.handle(B,j).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=q.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=n.get("next.route");if(o){let t=`${k} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${P}`)}),s=!!(0,a.getRequestMeta)(e,"minimalMode"),c=async a=>{var i,c;let d=async({previousCacheEntry:n})=>{try{if(!s&&O&&x&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await r(a);e.fetchMetrics=j.renderOpts.fetchMetrics;let c=j.renderOpts.pendingWaitUntil;c&&o.waitUntil&&(o.waitUntil(c),c=void 0);let d=j.renderOpts.collectedTags;if(!z)return await (0,p.sendResponse)(G,K,i,j.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(i.headers);d&&(t[C.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==j.renderOpts.collectedRevalidate&&!(j.renderOpts.collectedRevalidate>=C.INFINITE_CACHE)&&j.renderOpts.collectedRevalidate,o=void 0===j.renderOpts.collectedExpire||j.renderOpts.collectedExpire>=C.INFINITE_CACHE?void 0:j.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:o}}}}catch(t){throw(null==n?void 0:n.isStale)&&await h.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:O})},!1,A),t}},l=await h.handleResponse({req:e,nextConfig:T,cacheKey:N,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:O,revalidateOnlyGenerated:x,responseGenerator:d,waitUntil:o.waitUntil,isMinimalMode:s});if(!z)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(c=l.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",O?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),D&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,m.fromNodeOutgoingHttpHeaders)(l.value.headers);return s&&z||y.delete(C.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,g.getCacheControlHeader)(l.cacheControl)),await (0,p.sendResponse)(G,K,new Response(l.value.body,{headers:y,status:l.value.status||200})),null};_?await c(_):await q.withPropagatedContext(e.headers,()=>q.trace(l.BaseServerSpan.handleRequest,{spanName:`${k} ${P}`,kind:i.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},c))}catch(t){if(t instanceof y.NoFallbackError||await h.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:O})},!1,A),z)throw t;return await (0,p.sendResponse)(G,K,new Response(null,{status:500})),null}}e.s(["handler",()=>I,"patchFetch",()=>x,"routeModule",()=>h,"serverHooks",()=>O,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>A],45521)},85685,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_crypto_c412f66b._.js"].map(t=>e.l(t))).then(()=>t(54799)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__fb3f81cb._.js.map