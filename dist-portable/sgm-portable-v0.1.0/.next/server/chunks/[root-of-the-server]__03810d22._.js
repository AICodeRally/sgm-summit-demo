module.exports=[93695,(e,t,n)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70406,(e,t,n)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,n)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},63021,(e,t,n)=>{t.exports=e.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},16496,e=>{"use strict";let t;function n(){let t;if("synthetic"===(process.env.BINDING_MODE||"synthetic"))throw Error("Cannot access Prisma client in synthetic mode. Use in-memory providers instead.");if(!process.env.DATABASE_URL)throw Error("DATABASE_URL is required for live binding mode. Set BINDING_MODE=synthetic to use in-memory providers.");if(!((t=process.env.DATABASE_URL)&&t.includes("schema=sgm_summit_demo")))throw Error("DATABASE_URL must include &schema=sgm_summit_demo for proper schema isolation.\nExample: postgresql://user:pass@host:5432/db?sslmode=require&schema=sgm_summit_demo");if(global.prisma)return global.prisma;let{PrismaClient:n}=e.r(63021);return new n({log:["error"]})}let a=new Proxy({},{get:(e,a)=>(t||(t=n()),t[a])});async function o(){global.prisma&&(await global.prisma.$disconnect(),global.prisma=void 0)}e.s(["disconnectPrisma",()=>o,"getPrismaClient",()=>n,"prisma",0,a])},79153,e=>{"use strict";let t=[{documentCode:"GC-001",title:"Sales Compensation Governance Committee Charter",documentType:"FRAMEWORK",category:"Governance",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"VP Sales Compensation",description:"SGCC committee structure, authority, and decision-making framework. Establishes 7-member committee with approval thresholds and meeting cadence."},{documentCode:"CRB-001",title:"Compensation Review Board Charter",documentType:"FRAMEWORK",category:"Governance",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"VP Sales Compensation",description:"CRB authority for windfall deals ($1M+), exceptions, and SPIF approvals. Defines 6 decision options for large deals."},{documentCode:"FWK-003",title:"Sales Segment & Role Classification Framework",documentType:"FRAMEWORK",category:"Plan Design",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Plan types, segment definitions, and role assignments across Enterprise, Mid-Market, and SMB segments."},{documentCode:"FWK-004",title:"Territory & Quota Management Framework",documentType:"FRAMEWORK",category:"Territory Management",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Territory rules, quota methodology, adjustment processes, and appeals framework."},{documentCode:"FWK-005",title:"Commission Metrics Framework",documentType:"FRAMEWORK",category:"Metrics",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"All compensation metrics defined: GARR, Net New ARR, Deal Registration, MBO/SPIFs, accelerators."},{documentCode:"FWK-006",title:"SPIF & Kicker Governance Framework",documentType:"FRAMEWORK",category:"SPIFs",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"SPIF types (Product Launch, Vertical, Seasonal), approval authority by budget tier, and tracking requirements."},{documentCode:"FWK-007",title:"Standard Taxonomy & Definitions Dictionary",documentType:"FRAMEWORK",category:"Reference",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Comprehensive glossary of compensation terms, SPARCC-specific language, and metric definitions."}],n=[{documentCode:"SCP-001",title:"Sales Crediting Policy",documentType:"POLICY",category:"Crediting",status:"APPROVED",version:"2.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Deal crediting rules for new logo, named accounts, renewals, and multi-rep splits. Includes SE allocation rules."},{documentCode:"SCP-002",title:"Quota Setting & Mid-Period Change Policy",documentType:"POLICY",category:"Quota Management",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Annual quota setting methodology, mid-year adjustment rules, and quota appeal process."},{documentCode:"SCP-003",title:"Payment Timing & Draw Policy",documentType:"POLICY",category:"Payments",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Finance",description:"Commission payment schedule, draw eligibility, and repayment terms for new hires."},{documentCode:"SCP-004",title:"Termination & Severance Policy",documentType:"POLICY",category:"Employment",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"HR",description:"Commission treatment on voluntary termination, involuntary termination, and severance scenarios."},{documentCode:"SCP-005",title:"Leave of Absence Policy",documentType:"POLICY",category:"Employment",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"HR",description:"Commission treatment during medical leave, parental leave, and extended absences."},{documentCode:"SCP-006",title:"Territory Change Policy",documentType:"POLICY",category:"Territory Management",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Rules for territory reassignments, protection periods, and transition credits."},{documentCode:"SCP-007",title:"Windfall & Large Deal Policy",documentType:"POLICY",category:"Large Deals",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"CRB",description:"Windfall identification criteria ($1M ARR, $100K+ payout) and CRB review process with 6 decision options."},{documentCode:"SCP-008",title:"SPIF Governance Policy",documentType:"POLICY",category:"SPIFs",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"SPIF approval thresholds: <$50K (SGCC), $50-250K (SGCC+CFO), >$250K (SGCC+CEO)."},{documentCode:"SCP-009",title:"Clawback & Recovery Policy",documentType:"POLICY",category:"Compliance",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Finance",description:"Overpayment recovery procedures, clawback triggers, and repayment schedules."},{documentCode:"SCP-010",title:"Multi-State Wage Law Compliance Policy",documentType:"POLICY",category:"Legal Compliance",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Legal",description:"State-specific wage law compliance (CA, NY, MA) for commission payments and deductions."},{documentCode:"SCP-011",title:"Section 409A Compliance Policy",documentType:"POLICY",category:"Tax Compliance",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Legal",description:"IRS Section 409A compliance for deferred commission and long-term incentives."},{documentCode:"SCP-012",title:"Data Retention Policy",documentType:"POLICY",category:"Data Governance",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Legal",description:"7-year retention for compensation records, calculations, and dispute documentation."},{documentCode:"SCP-013",title:"Version Control & Document Management Policy",documentType:"POLICY",category:"Governance",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Document versioning standards, approval workflows, and superseded document handling."},{documentCode:"SCP-014",title:"Standard Terms & Conditions",documentType:"POLICY",category:"Legal",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Legal",description:"Master T&Cs for all compensation plans including at-will employment language."},{documentCode:"SCP-015",title:"Cap & Threshold Guidelines",documentType:"POLICY",category:"Plan Design",status:"DRAFT",version:"0.9",effectiveDate:null,owner:"Sales Compensation",description:"Financial limits, acceleration caps, and attainment thresholds by role."},{documentCode:"SCP-016",title:"Draws & Guarantees Policy",documentType:"POLICY",category:"Payments",status:"DRAFT",version:"0.8",effectiveDate:null,owner:"Finance",description:"Draw request process, guarantee terms, and repayment obligations."},{documentCode:"SCP-017",title:"Mid-Period Plan Change Policy",documentType:"POLICY",category:"Plan Changes",status:"UNDER_REVIEW",version:"0.9",effectiveDate:null,owner:"Sales Compensation",description:"Rules for making plan changes mid-year including grandfathering and transition rules."}],a=[{documentCode:"PROC-001",title:"Quota Setting Procedures",documentType:"PROCEDURE",category:"Quota Management",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Step-by-step annual quota setting process including top-down allocation and rep-level assignment."},{documentCode:"PROC-002",title:"Territory Change Procedures",documentType:"PROCEDURE",category:"Territory Management",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Territory reassignment workflow including notification, transition period, and credit protection."},{documentCode:"PROC-003",title:"Sales Crediting Rules Documentation",documentType:"PROCEDURE",category:"Crediting",status:"APPROVED",version:"2.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Detailed crediting examples for all deal types with SE allocation matrices."},{documentCode:"PROC-004",title:"New Hire Onboarding Process",documentType:"PROCEDURE",category:"Onboarding",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"HR",description:"Compensation onboarding checklist including plan assignment, quota setting, and training."},{documentCode:"PROC-005",title:"Transfer & Promotion Procedures",documentType:"PROCEDURE",category:"Career Movement",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"HR",description:"Plan changes on internal transfers and promotions with protection rules."},{documentCode:"PROC-006",title:"Commission Reconciliation Procedures",documentType:"PROCEDURE",category:"Reconciliation",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Finance",description:"Month-end reconciliation process including data validation and variance investigation."},{documentCode:"PROC-007",title:"Pre-Payment Validation Checklist",documentType:"PROCEDURE",category:"Quality Control",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Finance",description:"Quality control gates before commission payout including audit checks."},{documentCode:"PROC-008",title:"Dispute Resolution Procedures",documentType:"PROCEDURE",category:"Disputes",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Escalation path for disputes: Manager → Sales Ops → CRB → SGCC with SLAs."},{documentCode:"PROC-009",title:"Exception Request Process",documentType:"PROCEDURE",category:"Exceptions",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"How to request exceptions including required documentation and approval routing."},{documentCode:"PROC-010",title:"Calculation Documentation Standard",documentType:"PROCEDURE",category:"Documentation",status:"APPROVED",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Standard templates for documenting commission calculations with audit trail."}],o=[{documentCode:"TPL-001",title:"SGCC Meeting Agenda Template",documentType:"TEMPLATE",category:"Meetings",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Standard agenda format for quarterly SGCC meetings."},{documentCode:"TPL-002",title:"CRB Meeting Agenda Template",documentType:"TEMPLATE",category:"Meetings",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Standard agenda for windfall deal reviews and exception approvals."},{documentCode:"TPL-003",title:"Meeting Minutes Template",documentType:"TEMPLATE",category:"Documentation",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Standard format for recording SGCC and CRB meeting minutes."},{documentCode:"TPL-004",title:"Plan Announcement Template",documentType:"TEMPLATE",category:"Communications",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Email template for announcing new compensation plans to sales team."},{documentCode:"TPL-005",title:"FAQ Template",documentType:"TEMPLATE",category:"Documentation",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"Format for plan FAQs with common questions and answers."},{documentCode:"TPL-006",title:"Plan Summary Template",documentType:"TEMPLATE",category:"Plan Design",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"One-page plan summary template for rep communication."},{documentCode:"TPL-007",title:"CRB Decision Log Template",documentType:"TEMPLATE",category:"Decisions",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"CRB",description:"Standard format for recording CRB windfall decisions with rationale."},{documentCode:"TPL-008",title:"Quota Adjustment Request Form",documentType:"TEMPLATE",category:"Forms",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Form for requesting mid-year quota adjustments with justification."},{documentCode:"TPL-009",title:"Territory Change Request Form",documentType:"TEMPLATE",category:"Forms",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Operations",description:"Request form for territory reassignments and modifications."},{documentCode:"TPL-010",title:"Exception Request Form",documentType:"TEMPLATE",category:"Forms",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"General exception request form with approval routing."},{documentCode:"TPL-011",title:"Commission Statement Template",documentType:"TEMPLATE",category:"Statements",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Finance",description:"Monthly commission statement format showing calculations and payouts."},{documentCode:"TPL-012",title:"New Plan Launch Checklist",documentType:"TEMPLATE",category:"Checklists",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"30-point checklist for launching new compensation plans."}],i=[{documentCode:"CHK-001",title:"Governance Implementation Checklist",documentType:"CHECKLIST",category:"Implementation",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Compensation",description:"7-phase implementation checklist with 90+ tasks for rolling out governance framework."}],r=[{documentCode:"GUIDE-001",title:"Sales Rep Compensation Guide",documentType:"GUIDE",category:"Enablement",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Enablement",description:"Complete guide for sales reps covering plans, crediting, statements, and dispute resolution."},{documentCode:"GUIDE-002",title:"Sales Manager Enablement Guide",documentType:"GUIDE",category:"Enablement",status:"ACTIVE",version:"1.0",effectiveDate:"2026-01-01",owner:"Sales Enablement",description:"Manager guide for handling team comp questions, approving exceptions, and coaching."}],s=[...t,...n,...a,...o,...i,...r];t.length,n.length,a.length,o.length,i.length,r.length,s.length,e.s(["ALL_GOVERNANCE_DOCUMENTS",0,s])},82956,e=>{"use strict";var t=e.i(69719);let n=t.z.enum(["COMPENSATION_PLAN","GOVERNANCE_PLAN","POLICY_CREATION_PLAN"]),a=t.z.enum(["DRAFT","ACTIVE","DEPRECATED","ARCHIVED"]),o=t.z.enum(["SYSTEM","USER_CREATED","CLONED"]),i=t.z.object({id:t.z.string().cuid(),tenantId:t.z.string(),code:t.z.string().regex(/^TPL-[A-Z]+-\d{3}$/,"Template code must match pattern TPL-XXX-000"),name:t.z.string().min(1).max(200),description:t.z.string().max(2e3).optional(),planType:n,category:t.z.string().max(100).optional(),tags:t.z.array(t.z.string().max(50)).optional(),version:t.z.string().regex(/^\d+\.\d+\.\d+$/,"Version must be semantic (x.y.z)"),status:a,source:o,isSystemTemplate:t.z.boolean().default(!1),clonedFromId:t.z.string().cuid().optional(),owner:t.z.string().max(200),createdBy:t.z.string().max(200),createdAt:t.z.coerce.date(),lastUpdated:t.z.coerce.date(),effectiveDate:t.z.coerce.date().optional(),usageCount:t.z.number().int().min(0).default(0),metadata:t.z.record(t.z.string(),t.z.any()).optional()}),r=i.omit({id:!0,createdAt:!0,lastUpdated:!0,usageCount:!0}).extend({tenantId:t.z.string(),code:t.z.string().regex(/^TPL-[A-Z]+-\d{3}$/),version:t.z.string().default("1.0.0"),status:a.default("DRAFT"),source:o.default("USER_CREATED"),isSystemTemplate:t.z.boolean().default(!1)}),s=i.partial().required({id:!0}),c=t.z.object({sourceTemplateId:t.z.string().cuid(),newCode:t.z.string().regex(/^TPL-[A-Z]+-\d{3}$/),newName:t.z.string().min(1).max(200),newOwner:t.z.string().max(200),clonedBy:t.z.string().max(200),customizeSections:t.z.boolean().default(!1)}),l=t.z.object({tenantId:t.z.string().optional(),planType:n.optional(),status:a.optional(),isSystemTemplate:t.z.boolean().optional(),owner:t.z.string().optional(),search:t.z.string().optional(),tags:t.z.array(t.z.string()).optional(),category:t.z.string().optional()});t.z.object({templateId:t.z.string().cuid(),templateCode:t.z.string(),templateName:t.z.string(),totalUsageCount:t.z.number().int().min(0),activePlans:t.z.number().int().min(0),completedPlans:t.z.number().int().min(0),lastUsed:t.z.coerce.date().optional(),averageCompletionTime:t.z.number().optional()}),e.s(["ClonePlanTemplateSchema",0,c,"CreatePlanTemplateSchema",0,r,"PlanTemplateFiltersSchema",0,l,"UpdatePlanTemplateSchema",0,s])},507,e=>{"use strict";var t=e.i(47909),n=e.i(74017),a=e.i(96250),o=e.i(59756),i=e.i(61916),r=e.i(74677),s=e.i(69741),c=e.i(16795),l=e.i(87718),d=e.i(95169),p=e.i(47587),u=e.i(66012),m=e.i(70101),g=e.i(74838),C=e.i(10372),y=e.i(93695);e.i(52474);var P=e.i(220),f=e.i(89171);e.i(81605);var v=e.i(32750),R=e.i(82956);async function T(e){try{let t=e.nextUrl.searchParams,n=t.get("tags"),a=n?n.split(",").map(e=>e.trim()):void 0,o=R.PlanTemplateFiltersSchema.parse({tenantId:t.get("tenantId")||"demo-tenant-001",planType:t.get("planType")||void 0,status:t.get("status")||void 0,isSystemTemplate:t.get("isSystemTemplate")?"true"===t.get("isSystemTemplate"):void 0,owner:t.get("owner")||void 0,search:t.get("search")||void 0,tags:a,category:t.get("category")||void 0}),i=(0,v.getRegistry)().getPlanTemplate(),r=await i.findAll(o),s=o.tenantId||"demo-tenant-001",c=await i.countByStatus(s),l=await i.countByType(s);return f.NextResponse.json({templates:r,meta:{total:r.length,countsByStatus:c,countsByType:l,filters:o}},{status:200})}catch(e){return f.NextResponse.json({error:e.message,details:e.errors||void 0},{status:400})}}async function E(e){try{let t=await e.json(),n=R.CreatePlanTemplateSchema.parse(t),a=(0,v.getRegistry)(),o=a.getPlanTemplate(),i=a.getAudit(),r=await o.create(n);return await i.create({tenantId:r.tenantId,eventType:"create",severity:"info",message:`Plan template created: ${r.name}`,entityType:"plan_template",entityId:r.id,entityName:r.name,actorId:n.createdBy,actorName:n.createdBy}),f.NextResponse.json({template:r},{status:201})}catch(e){return f.NextResponse.json({error:e.message,details:e.errors||void 0},{status:400})}}e.s(["GET",()=>T,"POST",()=>E],18250);var h=e.i(18250);let w=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/plan-templates/route",pathname:"/api/plan-templates",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/plan-templates/route.ts",nextConfigOutput:"standalone",userland:h}),{workAsyncStorage:D,workUnitAsyncStorage:A,serverHooks:S}=w;function O(){return(0,a.patchFetch)({workAsyncStorage:D,workUnitAsyncStorage:A})}async function x(e,t,a){w.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let f="/api/plan-templates/route";f=f.replace(/\/index$/,"")||"/";let v=await w.prepare(e,t,{srcPage:f,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:R,params:T,nextConfig:E,parsedUrl:h,isDraftMode:D,prerenderManifest:A,routerServerContext:S,isOnDemandRevalidate:O,revalidateOnlyGenerated:x,resolvedPathname:I,clientReferenceManifest:L,serverActionsManifest:b}=v,M=(0,s.normalizeAppPath)(f),V=!!(A.dynamicRoutes[M]||A.routes[I]),F=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,h,!1):t.end("This page could not be found"),null);if(V&&!D){let e=!!A.routes[I],t=A.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await F();throw new y.NoFallbackError}}let z=null;!V||w.isDev||D||(z="/index"===(z=I)?"/":z);let N=!0===w.isDev||!V,k=V&&!N;b&&L&&(0,r.setManifestsSingleton)({page:f,clientReferenceManifest:L,serverActionsManifest:b});let q=e.method||"GET",U=(0,i.getTracer)(),_=U.getActiveScopeSpan(),G={params:T,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:N,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,a,o)=>w.onRequestError(e,t,a,o,S)},sharedContext:{buildId:R}},j=new c.NodeNextRequest(e),B=new c.NodeNextResponse(t),K=l.NextRequestAdapter.fromNodeNextRequest(j,(0,l.signalFromNodeResponse)(t));try{let r=async e=>w.handle(K,G).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=U.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=n.get("next.route");if(a){let t=`${q} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${f}`)}),s=!!(0,o.getRequestMeta)(e,"minimalMode"),c=async o=>{var i,c;let l=async({previousCacheEntry:n})=>{try{if(!s&&O&&x&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await r(o);e.fetchMetrics=G.renderOpts.fetchMetrics;let c=G.renderOpts.pendingWaitUntil;c&&a.waitUntil&&(a.waitUntil(c),c=void 0);let l=G.renderOpts.collectedTags;if(!V)return await (0,u.sendResponse)(j,B,i,G.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(i.headers);l&&(t[C.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==G.renderOpts.collectedRevalidate&&!(G.renderOpts.collectedRevalidate>=C.INFINITE_CACHE)&&G.renderOpts.collectedRevalidate,a=void 0===G.renderOpts.collectedExpire||G.renderOpts.collectedExpire>=C.INFINITE_CACHE?void 0:G.renderOpts.collectedExpire;return{value:{kind:P.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:a}}}}catch(t){throw(null==n?void 0:n.isStale)&&await w.onRequestError(e,t,{routerKind:"App Router",routePath:f,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:O})},!1,S),t}},d=await w.handleResponse({req:e,nextConfig:E,cacheKey:z,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:O,revalidateOnlyGenerated:x,responseGenerator:l,waitUntil:a.waitUntil,isMinimalMode:s});if(!V)return null;if((null==d||null==(i=d.value)?void 0:i.kind)!==P.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(c=d.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",O?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),D&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return s&&V||y.delete(C.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,g.getCacheControlHeader)(d.cacheControl)),await (0,u.sendResponse)(j,B,new Response(d.value.body,{headers:y,status:d.value.status||200})),null};_?await c(_):await U.withPropagatedContext(e.headers,()=>U.trace(d.BaseServerSpan.handleRequest,{spanName:`${q} ${f}`,kind:i.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},c))}catch(t){if(t instanceof y.NoFallbackError||await w.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:O})},!1,S),V)throw t;return await (0,u.sendResponse)(j,B,new Response(null,{status:500})),null}}e.s(["handler",()=>x,"patchFetch",()=>O,"routeModule",()=>w,"serverHooks",()=>S,"workAsyncStorage",()=>D,"workUnitAsyncStorage",()=>A],507)},85685,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_crypto_c412f66b._.js"].map(t=>e.l(t))).then(()=>t(54799)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__03810d22._.js.map